<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>mdzyart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #1976d2;
      min-height: 100vh;
      color: #fff;
    }
    #mdzyart-title {
      font-size: 2.5rem;
      font-weight: bold;
      margin: 30px 0 20px 0;
      text-align: center;
      letter-spacing: 2px;
    }
    #canvas {
      background: #fff;
      border-radius: 10px;
      touch-action: none;
      width: 100%;
      max-width: 900px;
      height: 500px;
      display: block;
      margin: 0 auto 20px auto;
      border: 2px solid #1565c0;
    }
    #chat-box {
      background: #e3f2fd;
      color: #222;
      border-radius: 10px;
      max-height: 200px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
    }
    #room-form, #chat-form {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 10px;
    }
    @media (max-width: 900px) {
      #canvas { height: 300px; }
    }
    @media (max-width: 600px) {
      #canvas { height: 200px; }
      #mdzyart-title { font-size: 2rem; }
    }
    #canvas-container {
  width: 100%;
  max-width: 900px;
  margin: 0 auto 20px auto;
  border-radius: 10px;
  overflow: hidden;
}
pinch-zoom {
  display: block;
  width: 100%;
  height: 100%;
}
#canvas {
  width: 100%;
  height: 500px;
  display: block;
}
@media (max-width: 900px) {
  #canvas { height: 300px; }
}
@media (max-width: 600px) {
  #canvas { height: 200px; }
}
body {
  background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
  min-height: 100vh;
  color: #333;
}
#main-card {
  background: #fff;
  border-radius: 24px;
  box-shadow: 0 8px 32px rgba(60,60,120,0.12);
  padding: 32px 16px;
  margin: 40px auto 0 auto;
  max-width: 960px;
}
#mdzyart-title {
  font-size: 2.5rem;
  font-weight: bold;
  margin: 0 0 20px 0;
  text-align: center;
  letter-spacing: 2px;
  color: #1976d2;
}
#canvas-container {
  background: #f5f7fa;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(60,60,120,0.08);
  padding: 16px;
  margin-bottom: 20px;
}
#chat-box {
  background: #e3f2fd;
  color: #222;
  border-radius: 10px;
  max-height: 200px;
  overflow-y: auto;
  padding: 10px;
  margin-bottom: 10px;
}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/pinch-zoom-js@2.3.4/dist/pinch-zoom.umd.min.js"></script>
</head>
<body>
  <audio id="bg-music" src="cute.mp3" loop autoplay></audio>
  <button id="music-toggle" class="btn btn-secondary">ðŸ”Š</button>

  <div id="main-card">
  <pinch-zoom>
    <div id="mdzyart-title">mdzyart</div>
    <form id="room-form" class="mb-3">
      <input type="text" id="room-input" class="form-control" placeholder="Room name" required style="max-width: 200px;">
      <button type="submit" class="btn btn-light">Join</button>
      <button type="button" id="leave-btn" class="btn btn-danger" disabled>Leave</button>
    </form>
    <div class="d-flex justify-content-center mb-2">
      <button id="clear-btn" class="btn btn-warning fw-bold">Clear Canvas</button>
    </div>
    <canvas id="canvas" width="900" height="500"></canvas>
    <div class="d-flex justify-content-center mb-2 gap-2">
  <button class="btn btn-primary color-btn" data-color="#1976d2" style="background:#1976d2;"></button>
  <button class="btn btn-danger color-btn" data-color="#e53935" style="background:#e53935;"></button>
  <button class="btn btn-success color-btn" data-color="#43a047" style="background:#43a047;"></button>
  <button class="btn btn-warning color-btn" data-color="#fbc02d" style="background:#fbc02d;"></button>
  <input type="color" id="custom-color" value="#1976d2" style="width:40px; height:40px; border:none;">
</div>
    <div id="chat-box"></div>
    <form id="chat-form" autocomplete="off">
      <input type="text" id="chat-input" class="form-control" placeholder="Type a message..." style="max-width: 300px;">
      <button type="submit" class="btn btn-light">Send</button>
    </form>
  </pinch-zoom>
  </div>

  <!-- Socket.IO -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    // === CONFIG ===
    // CHANGE THIS to your backend URL!
    const SERVER_URL = 'https://mdzyart.onrender.com';

    // === SOCKET.IO ===
    const socket = io(SERVER_URL);

    let currentRoom = null;

    // === ROOM JOIN/LEAVE ===
    const roomForm = document.getElementById('room-form');
    const roomInput = document.getElementById('room-input');
    const leaveBtn = document.getElementById('leave-btn');

    roomForm.onsubmit = e => {
      e.preventDefault();
      const room = roomInput.value.trim();
      if (!room) return;
      socket.emit('joinRoom', room);
      currentRoom = room;
      leaveBtn.disabled = false;
      roomInput.disabled = true;
    };

    leaveBtn.onclick = () => {
      if (currentRoom) {
        socket.emit('leaveRoom', currentRoom);
        currentRoom = null;
        leaveBtn.disabled = true;
        roomInput.disabled = false;
      }
    };

    // === CHAT ===
    const chatBox = document.getElementById('chat-box');
    const chatForm = document.getElementById('chat-form');
    const chatInput = document.getElementById('chat-input');

    function addMessage(msg, system = false) {
      const div = document.createElement('div');
      div.innerHTML = msg;
      if (system) div.style.fontStyle = 'italic';
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    socket.on('chat', ({ id, message }) => {
      addMessage(`<b>${id}:</b> ${message}`);
    });
    socket.on('system', msg => addMessage(`<span style="color:#1976d2">${msg}</span>`, true));

    chatForm.onsubmit = e => {
      e.preventDefault();
      if (!currentRoom) return;
      const msg = chatInput.value.trim();
      if (!msg) return;
      socket.emit('chat', { room: currentRoom, message: msg });
      chatInput.value = '';
    };

    // === CANVAS DRAWING ===
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false, last = null;

    function getPos(e) {
  const rect = canvas.getBoundingClientRect();
  let clientX, clientY;
  if (e.touches && e.touches.length > 0) {
    clientX = e.touches[0].clientX;
    clientY = e.touches[0].clientY;
  } else if (e.changedTouches && e.changedTouches.length > 0) {
    clientX = e.changedTouches[0].clientX;
    clientY = e.changedTouches[0].clientY;
  } else {
    clientX = e.clientX;
    clientY = e.clientY;
  }
  return {
    x: (clientX - rect.left) * (canvas.width / rect.width),
    y: (clientY - rect.top) * (canvas.height / rect.height)
  };
}


    function drawLine(from, to, color = currentColor, emit = true) {
  ctx.strokeStyle = color;
      ctx.lineWidth = 3;
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(from.x, from.y);
      ctx.lineTo(to.x, to.y);
      ctx.stroke();
      ctx.closePath();
      if (emit && currentRoom) {
    socket.emit('draw', { room: currentRoom, data: { from, to, color } });
  }
}

    function startDraw(e) {
      if (!currentRoom) return;
      drawing = true;
      last = getPos(e);
      e.preventDefault();
    }
    function moveDraw(e) {
      if (!drawing || !currentRoom) return;
      const pos = getPos(e);
      drawLine(last, pos);
      last = pos;
      e.preventDefault();
    }
    function endDraw(e) {
      drawing = false;
      last = null;
      if (e) e.preventDefault();
    }

    // Mouse events
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', moveDraw);
    canvas.addEventListener('mouseup', endDraw);
    canvas.addEventListener('mouseleave', endDraw);

    // Touch events
    canvas.addEventListener('touchstart', startDraw, { passive: false });
    canvas.addEventListener('touchmove', moveDraw, { passive: false });
    canvas.addEventListener('touchend', endDraw, { passive: false });
    canvas.addEventListener('touchcancel', endDraw, { passive: false });

    // Receive drawing from others
    socket.on('draw', data => {
      drawLine(data.from, data.to, data.color, false);
    });

    let currentColor = '#1976d2';
document.querySelectorAll('.color-btn').forEach(btn => {
  btn.onclick = () => {
    currentColor = btn.getAttribute('data-color');
  };
});
document.getElementById('custom-color').oninput = (e) => {
  currentColor = e.target.value;
};

    // === CLEAR CANVAS ===
    const clearBtn = document.getElementById('clear-btn');
    function clearCanvas(emit = true) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (emit && currentRoom) {
        socket.emit('clear', { room: currentRoom });
      }
    }
    clearBtn.onclick = () => clearCanvas();

    socket.on('clear', () => clearCanvas(false));

    // === CLEAR CANVAS ON ROOM CHANGE ===
    socket.on('system', msg => {
      if (msg.includes('joined')) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }
    });

    const music = document.getElementById('bg-music');
const musicToggle = document.getElementById('music-toggle');
music.volume = 0.5;
musicToggle.onclick = () => {
  if (music.paused) {
    music.play();
    musicToggle.textContent = 'ðŸ”Š';
  } else {
    music.pause();
    musicToggle.textContent = 'ðŸ”ˆ';
  }
};

  </script>
</body>
</html>
